The for-loop iterates over S[:-1], so the final move is never processed (the last character of S is skipped).
