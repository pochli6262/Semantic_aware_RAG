The hard-coded adjacency dictionary p includes vertical neighbors (up/down) as well as horizontal ones, so vertically adjacent numbers (e.g., 1 and 4) will incorrectly be treated as horizontally adjacent.
