The likely bug is that the program incorrectly replaces commas inside quotes instead of only replacing those outside of the quotes.
