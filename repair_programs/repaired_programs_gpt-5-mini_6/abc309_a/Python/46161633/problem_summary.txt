The code incorrectly treats a difference of 3 (A==B-3) as horizontal adjacency, so vertical neighbors are mistakenly considered adjacent.
