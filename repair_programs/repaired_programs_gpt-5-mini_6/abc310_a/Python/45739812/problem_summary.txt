The code computes the coupon cost as P - Q + d instead of the correct cost Q + d.
