The likely bug is that the program incorrectly calculates the probability for ranks between A+1 and B, as it mistakenly uses C instead of the total number of participants in that range when determining the probability of selection.
