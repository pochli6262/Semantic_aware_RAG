The likely bug is that the program incorrectly calculates the number of participants eligible for random selection by using the wrong range in the denominator when Iroha-chan ranks between A+1 and B.
