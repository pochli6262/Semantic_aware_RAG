The likely bug is that the program returns a 1-based index for occurrences rather than the expected 0-based index when looking up the k-th occurrence.
