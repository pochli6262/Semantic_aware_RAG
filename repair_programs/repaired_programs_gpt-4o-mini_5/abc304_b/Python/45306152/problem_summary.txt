The likely bug is that the loop incorrectly handles the truncation by using the wrong power of ten for the number of digits to be retained in each case.
