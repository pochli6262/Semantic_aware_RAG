The likely bug is that the condition checking if the j-th product has all functions of the i-th product is incorrectly implemented by using a union operation instead of verifying a proper subset relationship.
