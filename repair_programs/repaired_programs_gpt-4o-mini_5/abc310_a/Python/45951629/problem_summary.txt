The bug likely arises from calculating the total price incorrectly by using `P - Q + D[i]` instead of `Q + D[i]`.
