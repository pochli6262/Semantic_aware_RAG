The likely bug is that the truncation logic for the last condition incorrectly calculates the truncation for numbers in the range of 10^7 to 10^8-1 by using an incorrect divisor and multiplier.
